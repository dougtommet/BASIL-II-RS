

```{r}

all_pairs_df_initial <- readRDS(here::here("RData", "050-all_pairs_df_initial.rds"))
all_pairs_df_consensus <- readRDS(here::here("RData", "050-all_pairs_df_consensus.rds"))
```

```{r}

gtsummary::tbl_cross(all_pairs_df_initial, delirium_severity_A, delirium_severity_B)
```


```{r}
#| label: fig-heatmap-pre
#| fig-cap: "Heatmap showing agreement of paired initial ratings of delirium severity"
#| warning: false

all_pairs_df_initial %>%
  filter(!is.na(delirium_severity_A), !is.na(delirium_severity_B)) %>%
  group_by(delirium_severity_A, delirium_severity_B) %>%
  summarize(n = n()) %>%
  ggplot(aes(x = delirium_severity_A, y = delirium_severity_B, fill = n)) +
    geom_tile() +
    scale_x_continuous("Delirium Severity (Rater A)", breaks = 0:10, minor_breaks = NULL) +
    scale_y_reverse("Delirium Severity (Rater B)", breaks = 0:10, minor_breaks = NULL) +
    scale_fill_viridis_c(
      option = "C",
      trans = scales::pseudo_log_trans(sigma = 1),
      breaks = c(1, 3, 10, 30, 100, 200),
      name = "Count"
    ) +
    coord_fixed() +
    hrbrthemes::theme_ipsum()



# ggplot2::ggplot(rs_pairs, aes(x = deliriumseverity_1nA, y = deliriumseverity_1nB)) +
#   geom_bin2d(binwidth = 1) +
#   scale_fill_viridis_c(
#     option = "C",
#     trans = scales::pseudo_log_trans(sigma = 1),
#     breaks = c(1, 3, 10, 30, 100, 200),
#     name = "Count"
#   ) +
#   coord_fixed() +
#   labs(
#     x = "Delirium Severity (Rater A)",
#     y = "Delirium Severity (Rater B)",
#     fill = "Count"
#   ) +
#   theme_minimal()
```

```{r}
#| label: fig-heatmap-post
#| fig-cap: "Heatmap showing agreement of paired ratings of delirium severity after consensus process"
#| warning: false

all_pairs_df_consensus %>%
  filter(!is.na(delirium_severity_A), !is.na(delirium_severity_B)) %>%
  group_by(delirium_severity_A, delirium_severity_B) %>%
  summarize(n = n()) %>%
  ggplot(aes(x = delirium_severity_A, y = delirium_severity_B, fill = n)) +
    geom_tile() +
    scale_x_continuous("Delirium Severity (Rater A)", breaks = 0:10, minor_breaks = NULL) +
    scale_y_continuous("Delirium Severity (Rater B)", breaks = 0:10, minor_breaks = NULL) +
    scale_fill_viridis_c(
      option = "C",
      trans = scales::pseudo_log_trans(sigma = 1),
      breaks = c(1, 3, 10, 30, 100, 200),
      name = "Count"
    ) +
    coord_fixed() +
    hrbrthemes::theme_ipsum()

# ggplot2::ggplot(rs_pairs, aes(x = deliriumseverity_2nA, y = deliriumseverity_2nB)) +
#   geom_bin2d(binwidth = 1) +
#   scale_fill_viridis_c(
#     option = "C",
#     trans = scales::pseudo_log_trans(sigma = 1),
#     breaks = c(1, 3, 10, 30, 100, 200),
#     name = "Count"
#   ) +
#   coord_fixed() +
#   labs(
#     x = "Delirium Severity (Rater A)",
#     y = "Delirium Severity (Rater B)",
#     fill = "Count"
#   ) +
#   theme_minimal()
```
